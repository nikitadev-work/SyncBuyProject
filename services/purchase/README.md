# Documentation for **Purchase** microservice

Purchase service управляет совместными покупками: хранит покупки, участников и задачи (кто что добавил и на какую сумму), следит за жизненным циклом покупки.

---

## Основные функции

- **Покупки:** создание, получение, список; смена статусов (`Lock`, `Finish`, `Unlock` до начала расчётов).  
- **Участники:** добавление по **инвайт-токену**, удаление, получение списка участников.  
- **Задачи:** создание, взятие, завершение, удаление; при `LOCKED/FINISHED` — мутации запрещены.  
- **Снимок:** `GetSnapshot` собирает текущих участников и задачи в `LOCKED`.  

---

- `ACTIVE` — можно редактировать.  
- `LOCKED` — редактирование запрещено, доступны расчёты.  
- `FINISHED` — только чтение.  
- `Unlock` разрешён **только если** расчёты не начаты.  

---

## Структура проекта

```
internal/
 ├── app/                 # Инициализация, DI, запуск
 ├── adapters/
 │    ├── grpc/           # gRPC-сервер, мапперы, валидаторы, обработка ошибок
 │    ├── tokens/         # Провайдер инвайт-токенов
 ├── usecase/             # Application-слой: сценарии, валидации входа
 ├── domain/              # Доменные сущности (Purchase, Task, Participant)
 ├── repository/          # Доступ к БД (PostgreSQL), транзакции
migrations/               # SQL-схема
proto/                    # Контракт gRPC
services/purchase/proto-codegen/  # Сгенерированный код
```
